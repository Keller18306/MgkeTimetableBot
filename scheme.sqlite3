--
-- Файл сгенерирован с помощью SQLiteStudio v3.4.4 в сб февр. 10 02:01:25 2024
--
-- Использованная кодировка текста: System
--
PRAGMA foreign_keys = off;
BEGIN TRANSACTION;

-- Таблица: alice_users
CREATE TABLE alice_users (
    id      INTEGER PRIMARY KEY,
    userId  STRING  UNIQUE,
    mode    STRING,
    [group] STRING,
    teacher STRING
);


-- Таблица: api
CREATE TABLE api (
    id          INTEGER PRIMARY KEY AUTOINCREMENT,
    service     STRING,
    fromId      STRING,
    limitPerSec INT     NOT NULL,
    iv          STRING,
    last_time   BIGINT
);


-- Таблица: chat_aliases
CREATE TABLE chat_aliases (
    id      INTEGER PRIMARY KEY AUTOINCREMENT,
    service STRING  NOT NULL,
    chat_id INTEGER NOT NULL,
    subject STRING  NOT NULL,
    alias   STRING  NOT NULL,
    UNIQUE (
        service,
        chat_id,
        subject
    )
);


-- Таблица: chat_options
CREATE TABLE chat_options (
    service                  STRING           NOT NULL,
    id                       INTEGER          NOT NULL,
    accepted                 BOOLEAN          DEFAULT (0),
    ref                      STRING (255),
    scene                    STRING,
    mode                     STRING (16),
    [group]                  STRING (255),
    teacher                  STRING (255),
    google_email             STRING (10, 256) REFERENCES google_accounts (email),
    showAbout                BOOLEAN          DEFAULT (1),
    showDaily                BOOLEAN          DEFAULT (1),
    showWeekly               BOOLEAN          DEFAULT (1),
    showCalls                BOOLEAN          DEFAULT (1),
    showFastGroup            BOOLEAN          DEFAULT (1),
    showFastTeacher          BOOLEAN          DEFAULT (1),
    hidePastDays             BOOLEAN          DEFAULT (1),
    deleteLastMsg            BOOLEAN          DEFAULT (0),
    lastMsgId                INTEGER,
    lastMsgTime              BIGINT           DEFAULT (0),
    deleteUserMsg            BOOLEAN          DEFAULT (0),
    allowSendMess            BOOLEAN          DEFAULT (1),
    subscribeDistribution    BOOLEAN          DEFAULT (1),
    noticeChanges            BOOLEAN          DEFAULT (1),
    noticeNextWeek           BOOLEAN          DEFAULT (1),
    noticeParserErrors       BOOLEAN          DEFAULT (0),
    needUpdateButtons        BOOLEAN          DEFAULT (0),
    showParserTime           BOOLEAN          DEFAULT (0),
    showHints                BOOLEAN          DEFAULT (1),
    historyGroup             STRING           NOT NULL
                                              DEFAULT "[]",
    historyTeacher           STRING           NOT NULL
                                              DEFAULT "[]",
    scheduleFormatter        INTEGER          DEFAULT (0),
    eula                     BOOLEAN          DEFAULT (0),
    deactivateSecondaryCheck BOOLEAN          DEFAULT (0),
    UNIQUE (
        service,
        id
    )
);


-- Таблица: chat_subscription
CREATE TABLE chat_subscription (
    id      INTEGER PRIMARY KEY AUTOINCREMENT,
    service STRING  NOT NULL,
    chat_id INTEGER NOT NULL,
    type    STRING  NOT NULL,
    value   STRING  NOT NULL,
    UNIQUE (
        service,
        chat_id
    )
);


-- Таблица: google_accounts
CREATE TABLE google_accounts (
    id                   INTEGER          PRIMARY KEY AUTOINCREMENT,
    email                STRING (10, 256) UNIQUE,
    refresh_token        STRING (128),
    access_token         STRING (256),
    access_token_expires INTEGER
);


-- Таблица: storage
CREATE TABLE storage (
    storage STRING NOT NULL,
    key     STRING NOT NULL,
    value   STRING,
    time    INT,
    expires INT    DEFAULT (0),
    meta    STRING,
    UNIQUE (
        storage,
        key
    )
);


-- Таблица: tg_bot_chats
CREATE TABLE tg_bot_chats (
    id        INTEGER PRIMARY KEY AUTOINCREMENT,
    peerId    STRING  UNIQUE
                      NOT NULL,
    domain    STRING,
    firstName STRING,
    lastName  STRING,
    lang      STRING
);


-- Таблица: timetable_archive
CREATE TABLE timetable_archive (
    id      INTEGER      PRIMARY KEY AUTOINCREMENT,
    day     INTEGER      NOT NULL,
    [group] STRING (255),
    teacher STRING (255),
    data    TEXT,
    UNIQUE (
        day,
        [group]
    ),
    UNIQUE (
        day,
        teacher
    )
);


-- Таблица: viber_bot_chats
CREATE TABLE viber_bot_chats (
    id            INTEGER PRIMARY KEY AUTOINCREMENT,
    peerId        STRING  UNIQUE
                          NOT NULL,
    theme         STRING  DEFAULT white,
    lastUpdateDI  BIGINT  DEFAULT (0),
    name          STRING,
    device_os     STRING,
    device_type   STRING,
    viber_version STRING
);


-- Таблица: vk_app_users
CREATE TABLE vk_app_users (
    id             INTEGER      PRIMARY KEY AUTOINCREMENT,
    user_id        BIGINT       UNIQUE
                                NOT NULL,
    accepted       BOOLEAN      DEFAULT (0) 
                                NOT NULL,
    ref            STRING (255),
    [group]        STRING (255),
    teacher        STRING (255),
    theme_id       INT          DEFAULT (0),
    adblock        BOOLEAN      DEFAULT (0),
    firstPage      STRING (16),
    insert_time    BIGINT       NOT NULL,
    last_time      BIGINT       NOT NULL,
    allowBotAccept BOOLEAN      DEFAULT (1) 
);


-- Таблица: vk_bot_chats
CREATE TABLE vk_bot_chats (
    id               INTEGER PRIMARY KEY,
    peerId           INTEGER UNIQUE
                             NOT NULL,
    allowVkAppAccept BOOLEAN DEFAULT (1) 
);


-- Индекс: api_index
CREATE INDEX api_index ON api (
    service,
    fromId
);


-- Индекс: chat_aliases-chatIndex
CREATE INDEX [chat_aliases-chatIndex] ON chat_aliases (
    service,
    chat_id
);


-- Индекс: chat_options-distribution
CREATE INDEX [chat_options-distribution] ON chat_options (
    subscribeDistribution
);


-- Индекс: chat_options-group
CREATE INDEX [chat_options-group] ON chat_options (
    mode,
    "group"
);


-- Индекс: chat_options-noticeChanges
CREATE INDEX [chat_options-noticeChanges] ON chat_options (
    noticeChanges
);


-- Индекс: chat_options-noticeNextWeek
CREATE INDEX [chat_options-noticeNextWeek] ON chat_options (
    noticeNextWeek
);


-- Индекс: chat_options-secondaryCheck
CREATE INDEX [chat_options-secondaryCheck] ON chat_options (
    deactivateSecondaryCheck
);


-- Индекс: chat_options-sendMess
CREATE INDEX [chat_options-sendMess] ON chat_options (
    accepted,
    allowSendMess
);


-- Индекс: chat_options-teacher
CREATE INDEX [chat_options-teacher] ON chat_options (
    mode,
    teacher
);


-- Индекс: chat_subscription-entryIndex
CREATE INDEX [chat_subscription-entryIndex] ON chat_subscription (
    type,
    value
);


COMMIT TRANSACTION;
PRAGMA foreign_keys = on;
